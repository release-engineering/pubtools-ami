<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>delete &#8212; pubtools-ami  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="push" href="push.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="delete">
<h1>delete<a class="headerlink" href="#delete" title="Permalink to this heading">¶</a></h1>
<p><p>Deletes one or more Amazon Machine Images on AWS from specified
sources.</p>
<p>This command gets the AMIs from specified source, checks the image
presence in metadata service (e.g. RHSM) and makes image invisible in
this service. This is followed by deletion of image and related
snapshot in AWS.</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">pubtools</span><span class="o">-</span><span class="n">ami</span><span class="o">-</span><span class="n">delete</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">debug</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">access</span><span class="o">-</span><span class="nb">id</span> <span class="n">AWS_ACCESS_ID</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span> <span class="n">AWS_SECRET_KEY</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">url</span> <span class="n">RHSM_URL</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">cert</span> <span class="n">RHSM_CERT</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">key</span> <span class="n">RHSM_KEY</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">name</span> <span class="n">AWS_PROVIDER_NAME</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">--</span><span class="n">retry</span><span class="o">-</span><span class="n">wait</span> <span class="n">RETRY_WAIT</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">retries</span> <span class="n">MAX_RETRIES</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="n">snapshot</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">limit</span> <span class="n">LIMIT</span> <span class="p">[</span><span class="n">LIMIT</span> <span class="o">...</span><span class="p">]]</span>
                           <span class="n">source</span> <span class="p">[</span><span class="n">source</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<section id="named-arguments">
<h2>Named Arguments<a class="headerlink" href="#named-arguments" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--debug, -d</kbd></dt>
<dd><p>Show debug logs; can be provided up to three times to enable more logs</p>
<p>Default: 0</p>
</dd>
</dl>
</section>
<section id="aws-service">
<h2>AWS Service<a class="headerlink" href="#aws-service" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--aws-access-id</kbd></dt>
<dd><p>The AWS Service ID or Login to access the service (or set AWS_ACCESS_ID environment variable)</p>
<p>Default: “”</p>
</dd>
<dt><kbd>--aws-secret-key</kbd></dt>
<dd><p>The AWS Service key to access the service (or set AWS_SECRET_KEY environment variable)</p>
<p>Default: “”</p>
</dd>
</dl>
</section>
<section id="rhsm-service">
<h2>RHSM service<a class="headerlink" href="#rhsm-service" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--rhsm-url</kbd></dt>
<dd><p>Base URL of the RHSM API</p>
</dd>
<dt><kbd>--rhsm-cert</kbd></dt>
<dd><p>RHSM API certificate path (or set RHSM_CERT environment variable)</p>
</dd>
<dt><kbd>--rhsm-key</kbd></dt>
<dd><p>RHSM API key path (or set RHSM_KEY environment variable)</p>
</dd>
</dl>
</section>
<section id="ami-common-options">
<h2>AMI common options<a class="headerlink" href="#ami-common-options" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>source</kbd></dt>
<dd><p>source location of the staged AMIs with the source type. e.g. staged:/path/to/stage/ami or errata:https://errata.example.com?errata=RHBA-2020:1234 or pub:https://pub.example.com?task_id=125222</p>
</dd>
<dt><kbd>--aws-provider-name</kbd></dt>
<dd><p>AWS provider e.g. AWS, ACN (AWS China), AGOV (AWS US Gov)</p>
<p>Default: “AWS”</p>
</dd>
<dt><kbd>--retry-wait</kbd></dt>
<dd><p>duration to wait in sec before retrying action on AWS</p>
<p>Default: 30</p>
</dd>
<dt><kbd>--max-retries</kbd></dt>
<dd><p>number of retries on failure with action on AWS</p>
<p>Default: 4</p>
</dd>
</dl>
</section>
<section id="ami-delete-options">
<h2>AMI delete options<a class="headerlink" href="#ami-delete-options" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--keep-snapshot</kbd></dt>
<dd><p>Do not delete snapshot from AWS</p>
<p>Default: False</p>
</dd>
<dt><kbd>--dry-run</kbd></dt>
<dd><p>Skip destructive actions on rhsm or AWS</p>
<p>Default: False</p>
</dd>
<dt><kbd>--limit</kbd></dt>
<dd><p>Only remove the specified AMIs by AMI image id</p>
</dd>
</dl>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>A typical invocation of delete would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pubtools-ami-delete \
  --rhsm-url https://rhsm.example.com \
  --aws-provider-name awstest \
  --aws-access-id access_id \
  --aws-secret-key secret_key \
  pub:https://pub.example.com?task_id=123456
</pre></div>
</div>
<p>All the AMIs in the given source path will be made invisible
in RHSM and then deleted on AWS with related snapshots.</p>
</section>
<section id="example-keep-snapshots">
<h2>Example: keep snapshots<a class="headerlink" href="#example-keep-snapshots" title="Permalink to this heading">¶</a></h2>
<p>Running delete while keeping snapshots untouched.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pubtools-ami-delete \
  --rhsm-url https://rhsm.example.com \
  --keep-snapshot \
  --aws-provider-name awstest \
  --aws-access-id access_id \
  --aws-secret-key secret_key \
  pub:https://pub.example.com?task_id=123456
</pre></div>
</div>
</section>
<section id="example-dry-run">
<h2>Example: dry-run<a class="headerlink" href="#example-dry-run" title="Permalink to this heading">¶</a></h2>
<p>Running dry-run delete - no destructive actions happen,
expected actions are logged.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pubtools-ami-delete \
  --rhsm-url https://rhsm.example.com \
  --dry-run \
  --aws-provider-name awstest \
  --aws-access-id access_id \
  --aws-secret-key secret_key \
  pub:https://pub.example.com?task_id=123456
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pubtools-ami</a></h1>



<p class="blurb">Publishing tools for Amazon Machine Images(AMI)</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Command Reference:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="push.html">push</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">delete</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/release-engineering/pubtools-ami">Source</a></li>
    
    <li class="toctree-l1"><a href="https://pypi.org/project/pubtools-ami">PyPI</a></li>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="push.html" title="previous chapter">push</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Red Hat.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/delete.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/release-engineering/pubtools-ami" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>
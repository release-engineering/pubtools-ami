<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>push &#8212; pubtools-ami  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=1fc5d657" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="delete" href="delete.html" />
    <link rel="prev" title="pubtools-ami" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="push">
<h1>push<a class="headerlink" href="#push" title="Permalink to this heading">¶</a></h1>
<p><p>Pushes one or more Amazon Machine Images to AWS from the specified
sources.</p>
<p>This command gets the AMIs from the provided sources, checks for the
image product in the metadata service e.g. RHSM and then uploads to
AWS using the image metadata from the source. The image metadata is
then updated to the metadata service post upload if the images were
shipped to the users.</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">pubtools</span><span class="o">-</span><span class="n">ami</span><span class="o">-</span><span class="n">push</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">debug</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">access</span><span class="o">-</span><span class="nb">id</span> <span class="n">AWS_ACCESS_ID</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span> <span class="n">AWS_SECRET_KEY</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">url</span> <span class="n">RHSM_URL</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">cert</span> <span class="n">RHSM_CERT</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">key</span> <span class="n">RHSM_KEY</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">name</span> <span class="n">AWS_PROVIDER_NAME</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">retry</span><span class="o">-</span><span class="n">wait</span> <span class="n">RETRY_WAIT</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">retries</span> <span class="n">MAX_RETRIES</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">ship</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">container</span><span class="o">-</span><span class="n">prefix</span> <span class="n">CONTAINER_PREFIX</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">accounts</span> <span class="n">ACCOUNTS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">public</span><span class="o">-</span><span class="n">images</span><span class="p">]</span>
                         <span class="p">[</span><span class="o">--</span><span class="n">snapshot</span><span class="o">-</span><span class="n">account</span><span class="o">-</span><span class="n">ids</span> <span class="n">SNAPSHOT_ACCOUNT_IDS</span><span class="p">]</span>
                         <span class="n">source</span> <span class="p">[</span><span class="n">source</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<section id="named-arguments">
<h2>Named Arguments<a class="headerlink" href="#named-arguments" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--debug, -d</kbd></dt>
<dd><p>Show debug logs; can be provided up to three times to enable more logs</p>
<p>Default: 0</p>
</dd>
</dl>
</section>
<section id="aws-service">
<h2>AWS Service<a class="headerlink" href="#aws-service" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--aws-access-id</kbd></dt>
<dd><p>The AWS Service ID or Login to access the service (or set AWS_ACCESS_ID environment variable)</p>
<p>Default: “”</p>
</dd>
<dt><kbd>--aws-secret-key</kbd></dt>
<dd><p>The AWS Service key to access the service (or set AWS_SECRET_KEY environment variable)</p>
<p>Default: “”</p>
</dd>
</dl>
</section>
<section id="rhsm-service">
<h2>RHSM service<a class="headerlink" href="#rhsm-service" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--rhsm-url</kbd></dt>
<dd><p>Base URL of the RHSM API</p>
</dd>
<dt><kbd>--rhsm-cert</kbd></dt>
<dd><p>RHSM API certificate path (or set RHSM_CERT environment variable)</p>
</dd>
<dt><kbd>--rhsm-key</kbd></dt>
<dd><p>RHSM API key path (or set RHSM_KEY environment variable)</p>
</dd>
</dl>
</section>
<section id="ami-common-options">
<h2>AMI common options<a class="headerlink" href="#ami-common-options" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>source</kbd></dt>
<dd><p>source location of the staged AMIs with the source type. e.g. staged:/path/to/stage/ami or errata:https://errata.example.com?errata=RHBA-2020:1234 or pub:https://pub.example.com?task_id=125222</p>
</dd>
<dt><kbd>--aws-provider-name</kbd></dt>
<dd><p>AWS provider e.g. AWS, ACN (AWS China), AGOV (AWS US Gov)</p>
<p>Default: “AWS”</p>
</dd>
<dt><kbd>--retry-wait</kbd></dt>
<dd><p>duration to wait in sec before retrying action on AWS</p>
<p>Default: 30</p>
</dd>
<dt><kbd>--max-retries</kbd></dt>
<dd><p>number of retries on failure with action on AWS</p>
<p>Default: 4</p>
</dd>
</dl>
</section>
<section id="ami-push-options">
<h2>AMI Push options<a class="headerlink" href="#ami-push-options" title="Permalink to this heading">¶</a></h2>
<dl class="option-list">
<dt><kbd>--ship</kbd></dt>
<dd><p>publish the AMIs in public domain</p>
<p>Default: False</p>
</dd>
<dt><kbd>--container-prefix</kbd></dt>
<dd><p>prefix to storage container for upload</p>
<p>Default: “redhat-cloudimg”</p>
</dd>
<dt><kbd>--accounts</kbd></dt>
<dd><p>region to accounts mapping for the accounts which will have permission to use the image in a region. If the accounts are not specific to a region, map them to defaults e.g. ‘{“region-1”: {“user-1”: “key-1”}}’ OR ‘{“default”: {“user-1”: “key-1”}}’ OR ‘{“region-1”: {“user-1”: “key-1”}, “default”: {“user-1”: “key-1”}}’</p>
<p>Default: {}</p>
</dd>
<dt><kbd>--allow-public-images</kbd></dt>
<dd><p>images are released for general use</p>
<p>Default: False</p>
</dd>
<dt><kbd>--snapshot-account-ids</kbd></dt>
<dd><p>JSON string mapping region to a list of account ids to give snapshot creation permissions to if a new snapshot is created as part of the image push.</p>
<p>Default: {}</p>
</dd>
</dl>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>A typical invocation of push would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pubtools</span><span class="o">-</span><span class="n">ami</span><span class="o">-</span><span class="n">push</span> \
  <span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">rhsm</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> \
  <span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">name</span> <span class="n">awstest</span> \
  <span class="o">--</span><span class="n">accounts</span> <span class="s1">&#39;{&quot;region-1&quot;: {&quot;access-r&quot;: &quot;secret-r&quot;},</span>
               <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;access-1&quot;</span><span class="p">:</span> <span class="s2">&quot;secret-1&quot;</span><span class="p">}}</span><span class="s1">&#39; </span><span class="se">\</span>
<span class="s1">  --aws-access-id access_id </span><span class="se">\</span>
<span class="s1">  --aws-secret-key secret_key </span><span class="se">\</span>
<span class="s1">  staged:/stage/ami/root</span>
</pre></div>
</div>
<p>All the AMIs in the given source path will be verified for
provider and product combination in RHSM and then uploaded
to AWS for the accounts of the region the image is pushed to
or the default accounts.</p>
</section>
<section id="example-ship-images">
<h2>Example: ship images<a class="headerlink" href="#example-ship-images" title="Permalink to this heading">¶</a></h2>
<p>To the ship the images to be available to users, –ship option
should be used. This updates the metadata on RHSM services.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pubtools</span><span class="o">-</span><span class="n">ami</span><span class="o">-</span><span class="n">push</span> \
  <span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">rhsm</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> \
  <span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">name</span> <span class="n">awstest</span> \
  <span class="o">--</span><span class="n">accounts</span> <span class="s1">&#39;{&quot;region-1&quot;: {&quot;access-r&quot;: &quot;secret-r&quot;},</span>
               <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;access-1&quot;</span><span class="p">:</span> <span class="s2">&quot;secret-1&quot;</span><span class="p">}}</span><span class="s1">&#39; </span><span class="se">\</span>
<span class="s1">  --aws-access-id access_id </span><span class="se">\</span>
<span class="s1">  --aws-secret-key secret_key </span><span class="se">\</span>
<span class="s1">  --ship </span><span class="se">\</span>
<span class="s1">  staged:/stage/ami/root</span>
</pre></div>
</div>
<p>Shipping the images to general public i.e. ones that are available
to all like hourly images which can be used by general users for a
fee requires using –allow-public-images along with the above options.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pubtools</span><span class="o">-</span><span class="n">ami</span><span class="o">-</span><span class="n">push</span> \
  <span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">rhsm</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> \
  <span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">name</span> <span class="n">awstest</span> \
  <span class="o">--</span><span class="n">accounts</span> <span class="s1">&#39;{&quot;region-1&quot;: {&quot;access-r&quot;: &quot;secret-r&quot;},</span>
               <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;access-1&quot;</span><span class="p">:</span> <span class="s2">&quot;secret-1&quot;</span><span class="p">}}</span><span class="s1">&#39; </span><span class="se">\</span>
<span class="s1">  --aws-access-id access_id </span><span class="se">\</span>
<span class="s1">  --aws-secret-key secret_key </span><span class="se">\</span>
<span class="s1">  --ship </span><span class="se">\</span>
<span class="s1">  --allow-public-image </span><span class="se">\</span>
<span class="s1">  staged:/stage/ami/root</span>
</pre></div>
</div>
</section>
<section id="example-modify-retry">
<h2>Example: modify retry<a class="headerlink" href="#example-modify-retry" title="Permalink to this heading">¶</a></h2>
<p>Uploads might fail on the first try for any reason. It gets retired by default
for 4 times after every 30 seconds. These defaults can be modified as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pubtools</span><span class="o">-</span><span class="n">ami</span><span class="o">-</span><span class="n">push</span> \
  <span class="o">--</span><span class="n">rhsm</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">rhsm</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> \
  <span class="o">--</span><span class="n">aws</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">name</span> <span class="n">awstest</span> \
  <span class="o">--</span><span class="n">accounts</span> <span class="s1">&#39;{&quot;region-1&quot;: {&quot;access-r&quot;: &quot;secret-r&quot;},</span>
               <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;access-1&quot;</span><span class="p">:</span> <span class="s2">&quot;secret-1&quot;</span><span class="p">}}</span><span class="s1">&#39; </span><span class="se">\</span>
<span class="s1">  --aws-access-id access_id </span><span class="se">\</span>
<span class="s1">  --aws-secret-key secret_key </span><span class="se">\</span>
<span class="s1">  --max-retires 2 </span><span class="se">\</span>
<span class="s1">  --retry-wait 10 </span><span class="se">\</span>
<span class="s1">  staged:/stage/ami/root</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pubtools-ami</a></h1>



<p class="blurb">Publishing tools for Amazon Machine Images(AMI)</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Command Reference:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">push</a></li>
<li class="toctree-l1"><a class="reference internal" href="delete.html">delete</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/release-engineering/pubtools-ami">Source</a></li>
    
    <li class="toctree-l1"><a href="https://pypi.org/project/pubtools-ami">PyPI</a></li>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">pubtools-ami</a></li>
      <li>Next: <a href="delete.html" title="next chapter">delete</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Red Hat.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/push.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/release-engineering/pubtools-ami" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>